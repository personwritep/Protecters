// ==UserScript==
// @name         ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ç®¡ç†ãƒ»ãƒ–ãƒ­ãƒƒã‚¯ç®¡ç† ãƒ—ãƒ­ãƒ†ã‚¯ã‚¿ ğŸ”µ
// @namespace    http://tampermonkey.net/
// @version      0.2
// @description  ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼ç®¡ç†ãƒ»ãƒ–ãƒ­ãƒƒã‚¯ç®¡ç†ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ»ãƒ–ãƒ­ã‚°åã‚’ãƒ—ãƒ­ãƒ†ã‚¯ãƒˆã™ã‚‹ ã€ŒCtrl+F1ã€
// @author       Ameba Blog User
// @match        https://blog.ameba.jp/ucs/reader/readerlist.do
// @match        https://blog.ameba.jp/block
// @icon         https://www.google.com/s2/favicons?sz=64&domain=ameba.jp
// @grant        none
// ==/UserScript==


let date=new Date();
let shift1=date.getHours()+1; // 1ï½24ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤
let shift2=shift1%9 +1; // 1ï½9ã®ãƒ©ãƒ³ãƒ€ãƒ å€¤


let target=document.querySelector('head');
let monitor=new MutationObserver( catch_key );
monitor.observe(target, {childList: true}); // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå¾…å—ã‘é–‹å§‹

catch_key();

function catch_key(){
    document.addEventListener('keydown', (event)=>{
        if(event.ctrlKey && event.keyCode==112){ // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã€ŒCtrl+F1ã€
            event.stopImmediatePropagation();
            event.preventDefault();
            main(); }}, false);
} // catch_key()



let n=1; // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆæ¯ã«æ›´æ–°ã™ã‚‹å€¤


function main(){
    alert("ğŸ’¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ—ãƒ­ãƒ†ã‚¯ã‚¿ ãŒå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™");
    change_id_shift(n);
    change_block_id_shift(n)
    change_block_name();


    function change_id_shift(x){
        let name=document.querySelectorAll('.name');
        for(let k=0; k<name.length; k++){
            let name_link=name[k].querySelector('a');
            name_link.textContent=disguise(name_link.textContent, x); }}



    function change_block_id_shift(x){
        let block_id=document.querySelectorAll('.BlogWebBlock_status__66mul > span:last-child');
        for(let k=0; k<block_id.length; k++){
            block_id[k].textContent=disguise(block_id[k].textContent, x); }}


    function change_block_name(){
        let block_name=document.querySelectorAll('.BlogWebBlock_blog-title__HQRtx');
        for(let k=0; k<block_name.length; k++){
            block_name[k].textContent=stir(block_name[k].textContent, shift1, shift2); }}



    function disguise(str, xx){
        let str_=str.split('');
        for(let k=0; k<str_.length; k++){
            let ASCII=str_[k].charCodeAt();
            if(ASCII==45){ //ã€Œ-ã€ã®å ´åˆ
                ASCII=101; } //ã€Œeã€ã«å¤‰æ›
            else if(ASCII>47 && ASCII<58){ //ã€Œ0ï½9ã€ã®å ´åˆ 48ï½57
                ASCII=(ASCII + xx -48)%10 +48; } // åŠè§’æ•°å­—ã‚’xxã‚·ãƒ•ãƒˆ
            else{ //ã€Œa-zã€ã®å ´åˆ 97ï½122
                ASCII=(ASCII + xx -97)%26 + 97; } // åŠè§’è‹±å°æ–‡å­—ã‚’xxã‚·ãƒ•ãƒˆ
            str_[k]=String.fromCharCode(ASCII); }

        return str_.join(''); }



    function stir(str, shift1, shift2){
        let ch=str.split('');
        for(let i=0; i<ch.length; i++){
            let alph=/[a-z]/;
            let alph_=/[A-Z]/;
            let num=/[0-9]/;
            let zen=/^[\p{scx=Hiragana}\p{scx=Katakana}\p{scx=Han}]+$/u;

            let ch_code;
            let n_ch_code;

            if(alph.test(ch[i])){
                ch_code=ch[i].charCodeAt(0); // 97ï½122
                if(ch_code+shift1>122){
                    n_ch_code=ch_code+shift1-26; }
                else{
                    n_ch_code=ch_code+shift1; }
                ch[i]=String.fromCharCode(n_ch_code); }

            if(alph_.test(ch[i])){
                ch_code=ch[i].charCodeAt(0); // 65ï½90
                if(ch_code+shift1>90){
                    n_ch_code=ch_code+shift1-26; }
                else{
                    n_ch_code=ch_code+shift1; }
                ch[i]=String.fromCharCode(n_ch_code); }

            if(num.test(ch[i])){
                ch_code=ch[i].charCodeAt(0); // 48ï½57
                if(ch_code+shift2>57){
                    n_ch_code=ch_code+shift2-10; }
                else{
                    n_ch_code=ch_code+shift2; }
                ch[i]=String.fromCharCode(n_ch_code); }

            if(zen.test(ch[i])){
                ch_code=ch[i].codePointAt(0); // unicode
                n_ch_code=ch_code+shift2;
                ch[i]=String.fromCodePoint(n_ch_code); }}

        return ch.join('');

    } //stir();


} // main()
